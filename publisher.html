<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publisher Profile | Siliguri News</title>
    <meta name="description" content="View all articles by this publisher on Siliguri News.">
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FDE047">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="assets/js/tailwind-config.js"></script>
    <!-- Force Light Mode -->
    <script>document.documentElement.classList.remove('dark'); localStorage.removeItem('theme');</script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Inter:wght@400;500;700;800;900&family=Space+Mono:wght@700&display=swap"
        rel="stylesheet">
    <!-- Custom Stylesheet -->
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body class="bg-gray-50 dark:bg-[#121212] text-gray-900 dark:text-gray-100 font-sans antialiased">

    <!-- HEADER -->
    <header class="bg-brandYellow sticky top-0 w-full h-[72px] flex items-center border-b border-black z-[80]">
        <div class="w-full px-4 md:px-10 flex justify-between items-center">
            <a href="index.html" class="font-serif italic text-3xl font-bold hover:opacity-80 transition">Siliguri<span
                    class="text-black">.</span></a>
            <a href="index.html" class="font-mono text-sm font-bold uppercase hover:underline">‚Üê Back to Stories</a>
        </div>
    </header>

    <!-- PUBLISHER HERO -->
    <div class="bg-black text-white py-16 border-b-[8px] border-brandYellow">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 flex flex-col sm:flex-row items-center gap-8">
            <!-- Avatar -->
            <div id="publisherAvatar"
                class="w-28 h-28 rounded-full bg-brandYellow text-black flex items-center justify-center text-5xl font-extrabold font-mono shrink-0 border-4 border-white shadow-xl">
                ?
            </div>
            <div>
                <span class="font-mono text-xs font-bold uppercase tracking-widest text-brandYellow">Publisher</span>
                <h1 id="publisherName" class="font-serif italic text-4xl md:text-5xl font-bold text-white mt-1">
                    Loading...</h1>
                <div class="flex items-center gap-4 mt-3">
                    <span id="articleCountBadge"
                        class="bg-white/10 text-white text-xs font-mono font-bold px-3 py-1 rounded-full border border-white/20">‚Äî
                        articles</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ARTICLES GRID -->
    <main class="max-w-5xl mx-auto px-4 sm:px-6 py-12">
        <h2
            class="font-mono text-xs font-bold uppercase tracking-widest text-gray-500 mb-8 border-b-2 border-black pb-3">
            All Articles</h2>

        <div id="articlesLoading" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
            <!-- Skeleton placeholders -->
            <div class="animate-pulse flex flex-col gap-3">
                <div class="aspect-[3/2] bg-gray-200 rounded"></div>
                <div class="h-4 bg-gray-200 rounded w-1/3"></div>
                <div class="h-5 bg-gray-200 rounded"></div>
                <div class="h-5 bg-gray-200 rounded w-4/5"></div>
            </div>
            <div class="animate-pulse flex flex-col gap-3">
                <div class="aspect-[3/2] bg-gray-200 rounded"></div>
                <div class="h-4 bg-gray-200 rounded w-1/3"></div>
                <div class="h-5 bg-gray-200 rounded"></div>
                <div class="h-5 bg-gray-200 rounded w-4/5"></div>
            </div>
            <div class="animate-pulse flex flex-col gap-3">
                <div class="aspect-[3/2] bg-gray-200 rounded"></div>
                <div class="h-4 bg-gray-200 rounded w-1/3"></div>
                <div class="h-5 bg-gray-200 rounded"></div>
                <div class="h-5 bg-gray-200 rounded w-4/5"></div>
            </div>
        </div>

        <div id="articlesGrid" class="hidden grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
            <!-- Loaded via JS -->
        </div>

        <div id="noArticles" class="hidden text-center py-20">
            <span class="text-5xl block mb-4">üì≠</span>
            <h3 class="text-2xl font-bold text-gray-700">No articles published yet.</h3>
            <a href="index.html" class="text-blue-600 hover:underline mt-3 block">Back to homepage</a>
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="bg-black text-white py-12 border-t-[16px] border-brandYellow">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 flex flex-col md:flex-row justify-between items-center gap-6">
            <h2 class="font-serif italic text-5xl text-brandYellow">Siliguri.</h2>
            <div class="flex gap-6 font-mono text-sm">
                <a href="#" class="hover:text-brandYellow transition">About</a>
                <a href="#" class="hover:text-brandYellow transition">Contact</a>
                <a href="#" class="hover:text-brandYellow transition">Privacy</a>
            </div>
            <p class="text-gray-400 text-xs">¬© 2026 Siliguri News Network. Siliguri, WB.</p>
        </div>
    </footer>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="assets/js/features.js"></script>

    <script>
        const supabaseUrl = 'https://dssxoikkhszevavriutc.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRzc3hvaWtraHN6ZXZhdnJpdXRjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2NjA3NDEsImV4cCI6MjA4NzIzNjc0MX0.SJx4tz808lDKuiNE3lXY4kAT_ikwTTxNlacbhYpUvZw';
        const supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);

        async function loadPublisherProfile() {
            const params = new URLSearchParams(window.location.search);
            const authorEmail = params.get('email');

            if (!authorEmail) {
                document.getElementById('articlesLoading').innerHTML = '<p class="col-span-3 text-center text-gray-500">No publisher specified.</p>';
                return;
            }

            // Set display name from email
            const displayName = authorEmail.split('@')[0];
            document.getElementById('publisherName').innerText = displayName;
            document.getElementById('publisherAvatar').innerText = displayName.charAt(0).toUpperCase();
            document.title = `${displayName} | Siliguri Publisher`;

            try {
                const { data, error } = await supabaseClient
                    .from('articles')
                    .select('*')
                    .eq('author_email', authorEmail)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                document.getElementById('articlesLoading').classList.add('hidden');
                const grid = document.getElementById('articlesGrid');

                if (!data || data.length === 0) {
                    document.getElementById('noArticles').classList.remove('hidden');
                    return;
                }

                document.getElementById('articleCountBadge').innerText = `${data.length} article${data.length !== 1 ? 's' : ''}`;
                grid.classList.remove('hidden');

                grid.innerHTML = data.map(article => {
                    const img = article.image_url || article.image || 'https://images.unsplash.com/photo-1546422904-90eab23c3d7e?q=80&w=800&auto=format&fit=crop';
                    const date = article.created_at ? new Date(article.created_at).toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' }) : (article.date || '');
                    const views = article.views ? `<span class="text-gray-400 text-xs">üëÅ ${formatViewCount(article.views)}</span>` : '';
                    const premTag = article.type === 'premium' ? '<span class="bg-black text-brandYellow text-[10px] font-mono font-bold px-2 py-0.5 uppercase ml-1">Premium</span>' : '';
                    const tags = article.tags && article.tags.length > 0
                        ? article.tags.slice(0, 3).map(t => `<span class="text-[10px] font-mono text-gray-400">#${t}</span>`).join(' ')
                        : '';
                    return `
                    <a href="article.html?id=${article.id}" class="group flex flex-col gap-3 cursor-pointer">
                        <div class="aspect-[3/2] overflow-hidden bg-gray-100 rounded">
                            <img src="${img}" alt="${article.title}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" loading="lazy">
                        </div>
                        <div class="flex items-center gap-2 flex-wrap">
                            <span class="font-mono text-[10px] font-bold uppercase tracking-wider text-white bg-black px-2 py-0.5">${article.category || 'News'}</span>
                            ${premTag}
                        </div>
                        <h3 class="font-bold text-lg leading-tight group-hover:text-blue-700 transition">${article.title}</h3>
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-gray-400 font-mono">${date}</span>
                            ${views}
                        </div>
                        ${tags ? `<div class="flex gap-2 flex-wrap">${tags}</div>` : ''}
                    </a>`;
                }).join('');

            } catch (err) {
                console.error(err);
                document.getElementById('articlesLoading').innerHTML = '<p class="col-span-3 text-center text-red-500">Failed to load articles.</p>';
            }
        }

        document.addEventListener('DOMContentLoaded', loadPublisherProfile);
    </script>
</body>

</html>